#!/bin/bash
if [ "$TRAVIS_BRANCH" == "master" -o "$TRAVIS_PULL_REQUEST" != "false" -o "$TRAVIS_TAG" != "" ]
then
  mkdir -p tmp
  brunch build --production 2>&1| tee tmp/output.txt
  if [ "$(cat tmp/output.txt | grep error)" == "" ]; then
    [ -n "$S3_CFG" ] && bundle exec s3_website cfg apply
    bundle exec s3_website push $( [ -n "$S3_FORCE" ] && echo '--force')
  else
    exit 1
  fi
else
  echo "no deployment for branch $TRAVIS_BRANCH"
fi
